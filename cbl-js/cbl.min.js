var CBL=function(g){var r={preprocess:function(){B("You should define a preprocess method!")},model_file:"",model_string:"",model_loaded:function(){},training_complete:function(){},blob_min_pixels:1,blob_max_pixels:99999,pattern_width:20,pattern_height:20,pattern_maintain_ratio:false,pattern_auto_rotate:false,incorrect_segment_char:"\\",blob_debug:"",blob_console_debug:false,allow_console_log:false,allow_console_warn:true,perceptive_colorspace:false,character_set:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",fixed_blob_locations:[]};g=g||{};for(var b in r){if(r.hasOwnProperty(b)&&!g.hasOwnProperty(b)){g[b]=r[b]}}var t={solve:function(F){return t.train(F,true)},done:function(F){w(function(){F(v);n()})},train:function(F,G){if(typeof G==="undefined"){G=false}w(function(){var I;var H=false;if(document.getElementById(F)!=null){I=document.getElementById(F)}else{I=document.createElement("img");H=true}var J=function(){var K="";var L=document.createElement("canvas");L.width=I.width;L.height=I.height;L.getContext("2d").drawImage(I,0,0);var N=new y(L);g.preprocess(N);var Q;if(g.fixed_blob_locations.length>0){Q=N.segmentBlocks(g.pattern_width,g.pattern_height,g.fixed_blob_locations,g.blob_debug)}else{Q=N.segmentBlobs(g.blob_min_pixels,g.blob_max_pixels,g.pattern_width,g.pattern_height,g.blob_debug)}if(!G){for(var M=0;M<Q.length;M++){var P=Q[M].toDataURL();var O=s(Q[M]);A.push({imgSrc:P,pattern:O,imgId:j,txtId:f,self:t,onComplete:g.training_complete})}if(!E){t.loadNextPattern()}E=true}else{for(var M=0;M<Q.length;M++){K+=l(s(Q[M]))}o("Solution = "+K)}v=K;n()};if(I.complete&&!H){J()}else{I.onload=J;if(H){I.src=F}}});return this},loadNextPattern:function(){var F=A.pop();if(F){o("Loading a pattern for human classification.");z();document.getElementById(F.imgId).src=F.imgSrc;document.getElementById(F.txtId).focus();document.getElementById(F.txtId).onkeyup=function(G){var H=document.getElementById(F.txtId).value;if((g.character_set.indexOf(H)>-1&&H.length)||H==g.incorrect_segment_char){if(H!=g.incorrect_segment_char){h.push({pattern:F.pattern,solution:document.getElementById(F.txtId).value});o('Added "'+document.getElementById(F.txtId).value+'" pattern to model!')}else{o("Did not add bad segment to model.")}document.getElementById(F.txtId).value="";if(A.length){F.self.loadNextPattern()}else{E=false;document.getElementById(F.txtId).onkeyup=function(){};if(typeof F.onComplete==="function"){F.onComplete();e()}}}else{document.getElementById(F.txtId).value=""}}}},loadModelString:function(I){I=u.decompressFromBase64(I);h=new Array();var H=I.replace(/\[/g,"").split("]");for(var F=0;F<H.length;F++){var K=H[F].split("=");if(K.length==2){var J=K[1];var G=K[0];h.push({pattern:J,solution:G})}}if(!h.length){B("No patterns to load in provided model.")}else{o("Model loaded with "+h.length+" patterns!");g.model_loaded()}},loadModel:function(F){try{var H=new XMLHttpRequest();H.open("GET",F,true);H.send();H.onreadystatechange=function(){if(H.readyState==4&&H.status==200&&H.responseText){t.loadModelString(H.responseText)}}}catch(G){B('Could not load model from "'+F+'"! ('+G.message+")")}},serializeModel:function(){var G="";for(var F=0;F<h.length;F++){G+="["+h[F].solution+"="+h[F].pattern+"]"}G=u.compressToBase64(G);return G},saveModel:function(){var G=t.serializeModel();var F=document.createElement("a");F.href="data:application/octet-stream,"+encodeURIComponent(G);F.setAttribute("download","cbl-model.dat");F.click()},debugModel:function(){for(var F=0;F<h.length;F++){o(h[F].solution+" pattern length = "+h[F].pattern.split(".").length)}},sortModel:function(){h=h.sort(function(G,F){return G.solution.localeCompare(F.solution)})},visualizeModel:function(I){for(var G=0;G<h.length;G++){var K=document.createElement("canvas");K.width=g.pattern_width;K.height=g.pattern_height;var M=K.getContext("2d").getImageData(0,0,g.pattern_width,g.pattern_height);var O=h[G].pattern.split(".");for(var N=0;N<g.pattern_width;N++){for(var L=0;L<g.pattern_height;L++){var H=N*4+L*4*g.pattern_width;var F=L+N*g.pattern_width;M.data[H]=O[F];M.data[H+1]=O[F];M.data[H+2]=O[F];M.data[H+3]=255}}K.getContext("2d").putImageData(M,0,0);var J=document.createElement("img");J.src=K.toDataURL();document.getElementById(I).appendChild(J)}},condenseModel:function(){var K=new Array();var H=h.length;for(var J=0;J<h.length;J++){var G=h[J].pattern.split(".");var L=false;for(var I=0;I<K.length;I++){if(K[I].solution==h[J].solution){for(var F=0;F<K[I].tempArray.length;F++){K[I].tempArray[F]=parseInt(K[I].tempArray[F])+parseInt(G[F])}K[I].tempCount++;L=true;break}}if(!L){K.push({pattern:h[J].pattern,solution:h[J].solution,tempArray:G,tempCount:1})}}for(var J=0;J<K.length;J++){for(var F=0;F<K[J].tempArray.length;F++){K[J].tempArray[F]=Math.round(K[J].tempArray[F]/K[J].tempCount)}K[J].pattern=K[J].tempArray.join(".")}h=K;o("Condensed model from "+H+" patterns to "+h.length+" patterns!");return this}};var y=function(F){var G={colorRegions:function(J,M,O){if(typeof M==="undefined"){M=false}if(typeof O==="undefined"){O=0}var I=new Array();var L=F.getContext("2d").getImageData(0,0,F.width,F.height);for(var H=0;H<L.width;H++){for(var N=0;N<L.height;N++){var K=H*4+N*4*L.width;if(!C(I,K)){G.floodfill(H,N,x(),J,L,I,M,O)}}}F.getContext("2d").putImageData(L,0,0);return this},display:function(H){document.getElementById(H).src=F.toDataURL();return this},debugImage:function(H){var I=document.createElement("img");I.src=F.toDataURL();document.getElementById(H).appendChild(I);return this},floodfill:function(N,L,ac,X,S,Z,V,P){var T=false;if(typeof S==="undefined"){T=true;S=F.getContext("2d").getImageData(0,0,F.width,F.height)}if(typeof P==="undefined"){P=0}var ab=S.data;var I=ab.length;var J=[];var W=(N+L*S.width)*4;var Y=W,O=W,aa,R,M=S.width*4;var H=[ab[W],ab[W+1],ab[W+2],ab[W+3]];var K=ab[W]+ab[W+1]+ab[W+2]+ab[W+3];if(!a(W,H,K,ac,ab,I,X)){return false}J.push(W);while(J.length){W=J.pop();if(typeof Z!=="undefined"){if(C(Z,W)){continue}}if(q(W,H,K,ac,ab,I,X,Z,V)){Y=W;O=W;R=(W/M)*M;aa=R+M;while(R<(O-=4)&&q(O,H,K,ac,ab,I,X,Z,V)){}while(aa>(Y+=4)&&q(Y,H,K,ac,ab,I,X,Z,V)){}if(P>0){O-=P*4;Y+=P*4}for(var U=O;U<Y;U+=4){if(U-M>=0&&a(U-M,H,K,ac,ab,I,X)){J.push(U-M)}if(U+M<I&&a(U+M,H,K,ac,ab,I,X)){J.push(U+M)}}}}if(T){F.getContext("2d").putImageData(S,0,0)}},blur:function(H){if(typeof H==="undefined"){H=1}if(H==2){return this.convolute([[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],1/25)}else{if(H==3){return this.convolute([[1,1,1,1,1,1,1],[1,1,1,1,1,1,1],[1,1,1,1,1,1,1],[1,1,1,1,1,1,1],[1,1,1,1,1,1,1],[1,1,1,1,1,1,1],[1,1,1,1,1,1,1]],1/49)}else{return this.convolute([[1,1,1],[1,1,1],[1,1,1]],1/9)}}},sharpen:function(){return this.convolute([[0,-1,0],[-1,5,-1],[0,-1,0]])},grayscale:function(){var K=F.getContext("2d").getImageData(0,0,F.width,F.height);for(var H=0;H<K.width;H++){for(var L=0;L<K.height;L++){var I=H*4+L*4*K.width;var J=0.34*K.data[I]+0.5*K.data[I+1]+0.16*K.data[I+2];K.data[I]=J;K.data[I+1]=J;K.data[I+2]=J;K.data[I+3]=255}}F.getContext("2d").putImageData(K,0,0);return this},removeGray:function(I){var L=F.getContext("2d").getImageData(0,0,F.width,F.height);for(var H=0;H<L.width;H++){for(var M=0;M<L.height;M++){var J=H*4+M*4*L.width;var K=Math.max(Math.abs(L.data[J]-L.data[J+1]),Math.abs(L.data[J+1]-L.data[J+2]),Math.abs(L.data[J+2]-L.data[J]));if(K<I){L.data[J]=255;L.data[J+1]=255;L.data[J+2]=255;L.data[J+3]=255}}}F.getContext("2d").putImageData(L,0,0);return this},binarize:function(I){var L=F.getContext("2d").getImageData(0,0,F.width,F.height);for(var H=0;H<L.width;H++){for(var M=0;M<L.height;M++){var J=H*4+M*4*L.width;var K=0.34*L.data[J]+0.5*L.data[J+1]+0.16*L.data[J+2];L.data[J]=K>=I?255:0;L.data[J+1]=K>=I?255:0;L.data[J+2]=K>=I?255:0;L.data[J+3]=255}}F.getContext("2d").putImageData(L,0,0);return this},convolute:function(U,Q){var J=F.getContext("2d").getImageData(0,0,F.width,F.height);var M=F.getContext("2d").getImageData(0,0,F.width,F.height);var W=U[0].length;var N=U.length;var X=Math.floor(N/2);if(typeof Q==="undefined"){Q=1}var P=0;for(var S=0;S<J.height-1;S++){for(var T=0;T<J.width-1;T++){var V=T*4+S*4*J.width;var H=0;var O=0;var R=0;for(var I=0;I<W;I++){for(var L=0;L<N;L++){var K=((S+(I-X))*J.width+(T+(L-X)))*4;H+=J.data[(K+J.data.length)%J.data.length]*U[I][L];O+=J.data[(K+1+J.data.length)%J.data.length]*U[I][L];R+=J.data[(K+2+J.data.length)%J.data.length]*U[I][L]}}M.data[V+0]=Q*H+P;M.data[V+1]=Q*O+P;M.data[V+2]=Q*R+P;M.data[V+3]=255}}F.getContext("2d").putImageData(M,0,0);return this},erode:function(){return this.convolute([[-1,-1,-1],[-1,8,-1],[-1,-1,-1]])},foreach:function(K){var L=F.getContext("2d").getImageData(0,0,F.width,F.height);for(var H=0;H<L.width;H++){for(var M=0;M<L.height;M++){var J=H*4+M*4*L.width;var I={r:L.data[J+0],g:L.data[J+1],b:L.data[J+2]};I=K(I);L.data[J+0]=I.r;L.data[J+1]=I.g;L.data[J+2]=I.b;L.data[J+3]=255}}F.getContext("2d").putImageData(L,0,0);return this},invert:function(H){return this.foreach(function(I){I.r=255-I.r;I.g=255-I.g;I.b=255-I.b;return I})},cropRelative:function(L,K,I,H){var J=F.getContext("2d").getImageData(L,K,F.width-L-I,F.height-K-H);F.width=F.width-L-I;F.height=F.height-K-H;F.getContext("2d").putImageData(J,0,0);return this},getPixel:function(H,L){var K=F.getContext("2d").getImageData(0,0,F.width,F.height);var J=H*4+L*4*K.width;var I={r:K.data[J+0],g:K.data[J+1],b:K.data[J+2]};return I},segmentBlocks:function(U,J,S,T){if(typeof U==="undefined"){U=20}if(typeof J==="undefined"){J=20}if(typeof S==="undefined"){S=[]}var P=F.getContext("2d").getImageData(0,0,F.width,F.height);var Y=new Array();for(var Z=0;Z<S.length;Z++){var H=document.createElement("canvas");H.width=P.width;H.height=P.height;var R=H.getContext("2d").getImageData(0,0,F.width,F.height);var K=R.data;var Q=0;var L=S[Z].x1;var V=S[Z].x2;var M=S[Z].y1;var O=S[Z].y2;var X=document.createElement("canvas");X.width=V-L+1;X.height=O-M+1;X.getContext("2d").putImageData(P,-L,-M,L,M,X.width,X.height);H.width=U;H.height=J;if(g.pattern_maintain_ratio){var I=X.width;var N=X.height;if(I/U>N/J){H.getContext("2d").drawImage(X,0,0,U,N*(U/I))}else{H.getContext("2d").drawImage(X,0,0,I*(J/N),J)}}else{H.getContext("2d").drawImage(X,0,0,U,J)}Y.push(H);if(typeof T!=="undefined"&&T.length){if(g.blob_console_debug){o("Blob size = "+Q)}var W=document.createElement("img");W.src=H.toDataURL();document.getElementById(T).appendChild(W)}}return Y},segmentBlobs:function(ab,Y,aa,L,X){if(typeof ab==="undefined"){ab=1}if(typeof Y==="undefined"){Y=100000}if(typeof aa==="undefined"){aa=20}if(typeof L==="undefined"){L=20}var V=F.getContext("2d").getImageData(0,0,F.width,F.height);var J=function(ai,ah){return ai[ah]*255*255+ai[ah+1]*256+ai[ah+2]};var P=new Array();for(var Q=0;Q<V.width;Q++){for(var O=0;O<V.height;O++){var ac=Q*4+O*4*V.width;var H=J(V.data,ac);if(!C(P,H)){P.push(H)}}}var af=new Array();for(var ag=0;ag<P.length;ag++){var I=document.createElement("canvas");I.width=V.width;I.height=V.height;var W=I.getContext("2d").getImageData(0,0,F.width,F.height);var M=W.data;var U=0;var N=V.width;var Z=0;var R=V.height;var T=0;for(var Q=0;Q<V.width;Q++){for(var O=0;O<V.height;O++){var ac=Q*4+O*4*V.width;var H=J(V.data,ac);if(H==P[ag]){M[ac]=0;M[ac+1]=0;M[ac+2]=0;M[ac+3]=255;U++;if(Q<N){N=Q}if(Q>Z){Z=Q}if(O<R){R=O}if(O>T){T=O}}else{M[ac]=255;M[ac+1]=255;M[ac+2]=255;M[ac+3]=255}}}if(U>=ab&&U<=Y){var ae=document.createElement("canvas");ae.width=Z-N+1;ae.height=T-R+1;ae.getContext("2d").putImageData(W,-N,-R,N,R,ae.width,ae.height);I.width=aa;I.height=L;if(g.pattern_maintain_ratio){var K=ae.width;var S=ae.height;if(K/aa>S/L){I.getContext("2d").drawImage(ae,0,0,aa,S*(aa/K))}else{I.getContext("2d").drawImage(ae,0,0,K*(L/S),L)}}else{I.getContext("2d").drawImage(ae,0,0,aa,L)}if(g.pattern_auto_rotate){I=G.histogramRotate(I)}af.push(I);if(typeof X!=="undefined"&&X.length){if(g.blob_console_debug){o("Blob size = "+U)}var ad=document.createElement("img");ad.src=I.toDataURL();document.getElementById(X).appendChild(ad)}}}return af},histogramRotate:function(H){var P=new Image();P.src=H.toDataURL();var O=90;var L=5;var M=H;var J=H.width;for(var K=-O/2;K<=O/2;K+=L){var R=document.createElement("canvas");var Q=R.getContext("2d");R.width=H.width;R.height=H.height;Q.save();Q.translate(H.width/2,H.height/2);Q.rotate(K*Math.PI/180);Q.drawImage(P,-P.width/2,-P.width/2);Q.restore();var I=Q.getImageData(0,0,R.width,R.height);var U=0;for(var T=0;T<I.width;T++){for(var S=0;S<I.height;S++){var N=T*4+S*4*I.width;if(I.data[N]!=255&&I.data[N+3]!=0){U++;break}}}Q.putImageData(I,0,0);if(U<J){J=U;M=R}}return M}};return G};var h=new Array();var A=new Array();var E=false;var i=new Array();var d=false;var v="";var w=function(F){i.push(F);if(!d){n()}};var n=function(){if(i.length){d=true;i.shift()()}else{d=false}};var l=function(H){var I=4000000000;var F="?";for(var G=0;G<h.length;G++){var J=k(h[G].pattern,H);if(J<I){I=J;F=h[G].solution}}return F};var s=function(G){var I=new Array();var K=G.getContext("2d").getImageData(0,0,G.width,G.height);for(var F=0;F<K.width;F++){for(var L=0;L<K.height;L++){var H=F*4+L*4*K.width;var J=Math.round(0.34*K.data[H]+0.5*K.data[H+1]+0.16*K.data[H+2]);if(K.data[H+3]<255){J=255}I.push(J)}}return I.join(".")};var k=function(K,J){var H=K.split(".");var G=J.split(".");var I=0;for(var F=0;F<H.length;F++){I+=(H[F]-G[F])*(H[F]-G[F])}return Math.sqrt(I/H.length)};var a=function(K,F,L,H,J,G,N){if(K<0||K>=G){return false}var O=p(F,0);var I=p(J,K);var M=H;if(D(O,M)==0){return false}else{if(D(O,I)==0){return true}}if(g.perceptive_colorspace){if(m(O,I)<=N){return true}}else{if(D(O,I)<=N){return true}}return false};var q=function(J,F,K,H,I,G,N,M,L){if(a(J,F,K,H,I,G,N)){if(typeof M!=="undefined"){if(C(M,J)){return false}}if(!(L&&I[J]==255&&I[J+1]==255&&I[J+2]==255)){I[J]=H.r;I[J+1]=H.g;I[J+2]=H.b;I[J+3]=H.a}if(typeof M!=="undefined"){M.push(J)}return true}return false};var p=function(G,F){return{r:G[F],g:G[F+1],b:G[F+2]}};var D=function(G,F){return Math.max(Math.abs(G.r-F.r),Math.abs(G.g-F.g),Math.abs(G.g-F.g))};var D=function(G,F){return Math.sqrt((Math.pow(G.r-F.r,2),Math.pow(G.g-F.g,2),Math.pow(G.g-F.g,2))/3)};var m=function(H,F){var I=function(N,L){var M=G(J(N));var K=G(J(L));return Math.sqrt(Math.pow(M.l-K.l,2)+Math.pow(M.a-K.a,2)+Math.pow(M.b-K.b,2))};var J=function(N){var L=N.r/255;var K=N.g/255;var M=N.b/255;L=L>0.04045?Math.pow((L+0.055)/1.055,2.4):(L/12.92);K=K>0.04045?Math.pow((K+0.055)/1.055,2.4):(K/12.92);M=M>0.04045?Math.pow((M+0.055)/1.055,2.4):(M/12.92);L=L*100;K=K*100;M=M*100;return{x:L*0.4124+K*0.3576+M*0.1805,y:L*0.2126+K*0.7152+M*0.0722,z:L*0.0193+K*0.1192+M*0.9505}};var G=function(N){var M=N.x/95.047;var L=N.y/100;var K=N.z/108.883;M=M>0.008856?Math.pow(M,1/3):(7.787*M)+(16/116);L=L>0.008856?Math.pow(L,1/3):(7.787*L)+(16/116);K=K>0.008856?Math.pow(K,1/3):(7.787*K)+(16/116);return{l:(116*L)-16,a:500*(M-L),b:200*(L-K)}};return I(H,F)};var C=function(F,H){for(var G=0;G<F.length;G++){if(F[G]===H){return true}}return false};var c=function(H,G,F){return{r:H,g:G,b:F,a:255}};var x=function(){var H=Math.round(Math.random()*200)+55;var G;var F;while((G=Math.round(Math.random()*200)+55)==H){}while((F=Math.round(Math.random()*200)+55)==H||F==G){}return c(H,G,F)};var j="cbl-pattern";var f="cbl-solution";var e=function(){document.getElementById("cbl-trainer").style.display="none"};var z=function(){if(document.getElementById("cbl-trainer")!=null){document.getElementById("cbl-trainer").style.display="flex"}else{var F=function(G,H){var I=document.createElement("div");I.innerHTML=H;while(I.children.length>0){G.appendChild(I.children[0])}};F(document.body,'<div id="cbl-trainer">    <div id="cbl-trainer-dialog">        <span id="cbl-close" onclick="">&cross;</span>        <h1>CBL-js Pattern Classifier</h1>        <p>Identify the character in the image below by typing it into the textbox.</p>        <p>Type <span class="cbl-discard">'+g.incorrect_segment_char+'</span> to discard a pattern if the image was not segmented properly.</p>        <div class="cbl-row">            <div class="cbl-cell-50 cbl-right">                <img id="'+j+'" />            </div>            <div class="cbl-cell-50">                <input id="'+f+'" type="text" />            </div>        </div>    </div>    <small><a href="https://github.com/skotz/cbl-js" target="_blank">CBL-js &copy; Scott Clayton</a></small></div>');document.getElementById("cbl-close").addEventListener("click",function(G){e();G.preventDefault()})}};var o=function(F){if(g.allow_console_log){console.log("CBL: "+F)}};var B=function(F){if(g.allow_console_warn){console.warn("CBL: "+F)}};var u=function(){function J(M,L){if(!G[M]){G[M]={};for(var N=0;N<M.length;N++){G[M][M.charAt(N)]=N}}return G[M][L]}var H=String.fromCharCode,K="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",G={},F={compressToBase64:function(M){if(null==M){return""}var L=F._compress(M,6,function(N){return K.charAt(N)});switch(L.length%4){default:case 0:return L;case 1:return L+"===";case 2:return L+"==";case 3:return L+"="}},decompressFromBase64:function(L){return null==L?"":""==L?null:F._decompress(L.length,32,function(M){return J(K,L.charAt(M))})},compressToUTF16:function(L){return null==L?"":F._compress(L,15,function(M){return H(M+32)})+" "},decompressFromUTF16:function(L){return null==L?"":""==L?null:F._decompress(L.length,16384,function(M){return L.charCodeAt(M)-32})},compressToUint8Array:function(P){for(var N=F.compress(P),Q=new Uint8Array(2*N.length),O=0,L=N.length;L>O;O++){var M=N.charCodeAt(O);Q[2*O]=M>>>8,Q[2*O+1]=M%256}return Q},decompressFromUint8Array:function(O){if(null===O||void 0===O){return F.decompress(O)}for(var P=new Array(O.length/2),N=0,L=P.length;L>N;N++){P[N]=256*O[2*N]+O[2*N+1]}var M=[];return P.forEach(function(Q){M.push(H(Q))}),F.decompress(M.join(""))},compressToEncodedURIComponent:function(L){return null==L?"":F._compress(L,6,function(M){return I.charAt(M)})},decompressFromEncodedURIComponent:function(L){return null==L?"":""==L?null:(L=L.replace(/ /g,"+"),F._decompress(L.length,32,function(M){return J(I,L.charAt(M))}))},compress:function(L){return F._compress(L,16,function(M){return H(M)})},_compress:function(N,L,O){if(null==N){return""}var U,aa,R,ab={},M={},Z="",W="",X="",Q=2,T=3,S=2,V=[],P=0,Y=0;for(R=0;R<N.length;R+=1){if(Z=N.charAt(R),Object.prototype.hasOwnProperty.call(ab,Z)||(ab[Z]=T++,M[Z]=!0),W=X+Z,Object.prototype.hasOwnProperty.call(ab,W)){X=W}else{if(Object.prototype.hasOwnProperty.call(M,X)){if(X.charCodeAt(0)<256){for(U=0;S>U;U++){P<<=1,Y==L-1?(Y=0,V.push(O(P)),P=0):Y++}for(aa=X.charCodeAt(0),U=0;8>U;U++){P=P<<1|1&aa,Y==L-1?(Y=0,V.push(O(P)),P=0):Y++,aa>>=1}}else{for(aa=1,U=0;S>U;U++){P=P<<1|aa,Y==L-1?(Y=0,V.push(O(P)),P=0):Y++,aa=0}for(aa=X.charCodeAt(0),U=0;16>U;U++){P=P<<1|1&aa,Y==L-1?(Y=0,V.push(O(P)),P=0):Y++,aa>>=1}}Q--,0==Q&&(Q=Math.pow(2,S),S++),delete M[X]}else{for(aa=ab[X],U=0;S>U;U++){P=P<<1|1&aa,Y==L-1?(Y=0,V.push(O(P)),P=0):Y++,aa>>=1}}Q--,0==Q&&(Q=Math.pow(2,S),S++),ab[W]=T++,X=String(Z)}}if(""!==X){if(Object.prototype.hasOwnProperty.call(M,X)){if(X.charCodeAt(0)<256){for(U=0;S>U;U++){P<<=1,Y==L-1?(Y=0,V.push(O(P)),P=0):Y++}for(aa=X.charCodeAt(0),U=0;8>U;U++){P=P<<1|1&aa,Y==L-1?(Y=0,V.push(O(P)),P=0):Y++,aa>>=1}}else{for(aa=1,U=0;S>U;U++){P=P<<1|aa,Y==L-1?(Y=0,V.push(O(P)),P=0):Y++,aa=0}for(aa=X.charCodeAt(0),U=0;16>U;U++){P=P<<1|1&aa,Y==L-1?(Y=0,V.push(O(P)),P=0):Y++,aa>>=1}}Q--,0==Q&&(Q=Math.pow(2,S),S++),delete M[X]}else{for(aa=ab[X],U=0;S>U;U++){P=P<<1|1&aa,Y==L-1?(Y=0,V.push(O(P)),P=0):Y++,aa>>=1}}Q--,0==Q&&(Q=Math.pow(2,S),S++)}for(aa=2,U=0;S>U;U++){P=P<<1|1&aa,Y==L-1?(Y=0,V.push(O(P)),P=0):Y++,aa>>=1}for(;;){if(P<<=1,Y==L-1){V.push(O(P));break}Y++}return V.join("")},decompress:function(L){return null==L?"":""==L?null:F._decompress(L.length,32768,function(M){return L.charCodeAt(M)})},_decompress:function(S,T,Z){var O,W,P,R,N,ab,ac,V,Y=[],X=4,aa=4,U=3,M="",L=[],Q={val:Z(0),position:T,index:1};for(W=0;3>W;W+=1){Y[W]=W}for(R=0,ab=Math.pow(2,2),ac=1;ac!=ab;){N=Q.val&Q.position,Q.position>>=1,0==Q.position&&(Q.position=T,Q.val=Z(Q.index++)),R|=(N>0?1:0)*ac,ac<<=1}switch(O=R){case 0:for(R=0,ab=Math.pow(2,8),ac=1;ac!=ab;){N=Q.val&Q.position,Q.position>>=1,0==Q.position&&(Q.position=T,Q.val=Z(Q.index++)),R|=(N>0?1:0)*ac,ac<<=1}V=H(R);break;case 1:for(R=0,ab=Math.pow(2,16),ac=1;ac!=ab;){N=Q.val&Q.position,Q.position>>=1,0==Q.position&&(Q.position=T,Q.val=Z(Q.index++)),R|=(N>0?1:0)*ac,ac<<=1}V=H(R);break;case 2:return""}for(Y[3]=V,P=V,L.push(V);;){if(Q.index>S){return""}for(R=0,ab=Math.pow(2,U),ac=1;ac!=ab;){N=Q.val&Q.position,Q.position>>=1,0==Q.position&&(Q.position=T,Q.val=Z(Q.index++)),R|=(N>0?1:0)*ac,ac<<=1}switch(V=R){case 0:for(R=0,ab=Math.pow(2,8),ac=1;ac!=ab;){N=Q.val&Q.position,Q.position>>=1,0==Q.position&&(Q.position=T,Q.val=Z(Q.index++)),R|=(N>0?1:0)*ac,ac<<=1}Y[aa++]=H(R),V=aa-1,X--;break;case 1:for(R=0,ab=Math.pow(2,16),ac=1;ac!=ab;){N=Q.val&Q.position,Q.position>>=1,0==Q.position&&(Q.position=T,Q.val=Z(Q.index++)),R|=(N>0?1:0)*ac,ac<<=1}Y[aa++]=H(R),V=aa-1,X--;break;case 2:return L.join("")}if(0==X&&(X=Math.pow(2,U),U++),Y[V]){M=Y[V]}else{if(V!==aa){return null}M=P+P.charAt(0)}L.push(M),Y[aa++]=P+M.charAt(0),X--,P=M,0==X&&(X=Math.pow(2,U),U++)}}};return F}();"function"==typeof define&&define.amd?define(function(){return u}):"undefined"!=typeof module&&null!=module&&(module.exports=u);if(g.model_file.length){t.loadModel(g.model_file)}else{if(g.model_string.length){t.loadModelString(g.model_string)}}return t};